steps:
  # 1ë‹¨ê³„: dags í´ë” ë™ê¸°í™”
  - name: 'gcr.io/cloud-builders/gsutil'
    args: ['-m', 'rsync', '-r', '-d', 'dags', 'gs://asia-northeast3-tu-main-dat-d8e0bfa9-bucket/dags']

  # 2ë‹¨ê³„: requirements.txt íŒŒì¼ ë¹„êµ í›„, ë³€ê²½ëì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:460.0.0' # â—€ [ìˆ˜ì •] ë²„ì „ì„ 460.0.0ìœ¼ë¡œ ë³€ê²½
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        if gsutil diff -s requirements.txt gs://asia-northeast3-tu-main-dat-d8e0bfa9-bucket/requirements.txt >/dev/null 2>&1; then
          echo "âœ… requirements.txtì— ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. ì—…ë°ì´íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤."
        else
          echo "ğŸ”„ requirements.txtê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  í™˜ê²½ ì—…ë°ì´íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
          
          gsutil cp requirements.txt gs://asia-northeast3-tu-main-dat-d8e0bfa9-bucket/requirements.txt
          
          gcloud composer environments update tu-main-data-airflow-v1 \
            --location asia-northeast3 \
            --update-pypi-packages-from-file gs://asia-northeast3-tu-main-dat-d8e0bfa9-bucket/requirements.txt
        fi
options:
  logging: CLOUD_LOGGING_ONLY